{% extends "front/base.html.twig" %}

{% block title %} - Chat{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('css/subject_chat.css') }}">
{% endblock %}

{% block mainContent %}
    {% if needsSetup is defined and needsSetup %}
        {% include 'front/chat/_setup_modal.html.twig' with {
            'classes': classes,
            'specialites': specialites
        } %}
        <div class="chat-wrapper">
            <div class="container-fluid chat-container">
                <div class="text-center mt-5">
                    <h3>{% trans %}WELCOME_TO_CHAT_KEY{% endtrans %}</h3>
                    <p>{% trans %}PLEASE_SETUP_PROFILE_KEY{% endtrans %}</p>
                </div>
            </div>
        </div>
    {% else %}
        <div class="chat-container">
            <div class="sidebar">
                <div class="search-bar">
                    <input type="text" placeholder="{% trans %}SEARCH_SUBJECT_KEY{% endtrans %}">
                </div>
                <div class="subjects">
                    {% if chats is empty %}
                        <div class="no-subjects">
                            <p>{% trans %}NO_SUBJECTS_YET_KEY{% endtrans %}</p>
                        </div>
                    {% else %}
                        {% for chat in chats %}
                            <div class="subject" data-subject-id="{{ chat.id }}">
                                <div class="subject-icon">
                                    <i class="fas fa-{{ chat.matiere.icon|default('book') }}"></i>
                                </div>
                                <div class="subject-info">
                                    <h4>{{ chat.matiere.name }}</h4>
                                    <p class="teacher-name">Prof. {{ chat.teacherName|default('') }}</p>
                                </div>
                            </div>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>

            <div class="chat-window">
                <div class="welcome-screen">
                    <h2>{% trans %}WELCOME_TO_SUBJECT_CHAT_KEY{% endtrans %}</h2>
                    <p>{% trans %}SELECT_SUBJECT_TO_START_KEY{% endtrans %}</p>
                </div>
            </div>
        </div>
    {% endif %}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const subjects = document.querySelectorAll('.subject');
            subjects.forEach(subject => {
                subject.addEventListener('click', function() {
                    const subjectId = this.dataset.subjectId;
                    window.location.href = '{{ path("app_subject_chat", {"subject": "__ID__"}) }}'.replace('__ID__', subjectId);
                });
            });

            // Search functionality
            const searchInput = document.querySelector('.search-bar input');
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                subjects.forEach(subject => {
                    const subjectName = subject.querySelector('h4').textContent.toLowerCase();
                    const teacherName = subject.querySelector('.teacher-name').textContent.toLowerCase();
                    if (subjectName.includes(searchTerm) || teacherName.includes(searchTerm)) {
                        subject.style.display = 'flex';
                    } else {
                        subject.style.display = 'none';
                    }
                });
            });
        });
    </script>
{% endblock %}
