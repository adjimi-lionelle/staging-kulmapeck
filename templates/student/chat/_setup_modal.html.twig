<!-- Setup Modal -->
<div class="modal fade" id="setup-modal" data-bs-backdrop="static" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{% trans %}SETUP_PROFILE{% endtrans %}</h5>
            </div>
            <div class="modal-body">
                <form id="setup-form" method="POST" action="{{ path('app_student_setup') }}">
                    <div class="mb-3">
                        <label for="classe" class="form-label">{% trans %}SELECT_CLASS{% endtrans %}</label>
                        <select class="form-select" id="classe" name="classe" required>
                            <option value="">{% trans %}CHOOSE_CLASS{% endtrans %}</option>
                            {% for class in classes %}
                                <option value="{{ class.id }}" data-cycle="{{ class.cycle }}">{{ class.name }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="mb-3" id="specialization-group" style="display: none;">
                        <label for="specialization" class="form-label">{% trans %}SELECT_SPECIALIZATION{% endtrans %}</label>
                        <select class="form-select" id="specialization" name="specialization">
                            <option value="">{% trans %}CHOOSE_SPECIALIZATION{% endtrans %}</option>
                            {% for spec in specializations %}
                                <option value="{{ spec.id }}">{{ spec.name }}</option>
                            {% endfor %}
                        </select>
                        <div class="form-text text-muted">{% trans %}SPECIALIZATION_REQUIRED_SECOND_CYCLE{% endtrans %}</div>
                    </div>

                    <div class="text-end">
                        <button type="submit" class="btn btn-primary">{% trans %}SAVE{% endtrans %}</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const classeSelect = document.getElementById('classe');
    const specializationGroup = document.getElementById('specialization-group');
    const specializationSelect = document.getElementById('specialization');
    const setupForm = document.getElementById('setup-form');

    // Handle class selection change
    classeSelect.addEventListener('change', function() {
        const selectedOption = this.options[this.selectedIndex];
        const cycle = selectedOption.dataset.cycle;
        
        // Show specialization only for second cycle (2nde to Terminal)
        if (cycle === 'second') {
            specializationGroup.style.display = 'block';
            specializationSelect.required = true;
        } else {
            specializationGroup.style.display = 'none';
            specializationSelect.required = false;
            specializationSelect.value = ''; // Reset selection
        }
    });

    // Form validation
    setupForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        if (!classeSelect.value) {
            alert('{% trans %}PLEASE_SELECT_CLASS{% endtrans %}');
            return;
        }

        const cycle = classeSelect.options[classeSelect.selectedIndex].dataset.cycle;
        if (cycle === 'second' && !specializationSelect.value) {
            alert('{% trans %}PLEASE_SELECT_SPECIALIZATION{% endtrans %}');
            return;
        }

        // If validation passes, submit the form
        this.submit();
    });
});
</script>
