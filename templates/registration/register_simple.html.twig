{% extends "front/base.html.twig" %}

{% block title %} - {{ 'REGISTER_TITLE_KEY'|trans }}{% endblock %}

{% block mainContent %}
    <section class="mb-9 position-relative" style="background-image:url(assets/images/bg/07.jpg); background-position: center left; background-size: cover;">
        <!-- Background dark overlay -->
        <div class="bg-overlay bg-blue opacity-9"></div>
        <div class="container z-index-9 position-relative">
            <div class="row g-4 justify-content-between align-items-center">
                <!-- Content -->
                <div class="col-lg-6">
                    <h1 class="text-white">{{ 'WELCOME_LARGEST_COMMUNITY_KEY'|trans }}</h1>
                    <p class="text-white mb-3">{{ 'JOIN_COMMUNITY_DESCRIPTION_KEY'|trans }}</p>
                    <a href="{{ url("app_front_courses") }}" class="btn btn-white mb-0">{{ 'EXPLORE_COURSES_KEY'|trans }}<i class="bi bi-arrow-right ms-2"></i></a>
                </div>

                <!-- Form -->
                <div class="col-lg-6 col-xl-5 mb-n9">
                    <div class="card card-body shadow p-4 p-sm-5">
                        <div class="card-header bg-transparent pb-5">
                            <h1 class="h3">{{ 'CREATE_ACCOUNT_KEY'|trans }}</h1>
                            <p class="mb-0">
                                {{ 'ALREADY_HAVE_ACCOUNT_KEY'|trans }} <a href="{{ path('app_login') }}">{{ 'LOGIN_KEY'|trans }}</a>
                            </p>
                        </div>

                        <div class="card-body">
                            {{ form_start(registrationForm, {'attr': {'class': 'mt-4', 'id': 'registration_form'}}) }}
                                {# Display form level errors #}
                                {% if not registrationForm.vars.valid %}
                                    <div class="alert alert-danger">
                                        {% for error in registrationForm.vars.errors %}
                                            {{ error.message|trans }}
                                        {% endfor %}
                                    </div>
                                {% endif %}
                                <!-- Invitation Code -->
                                <div class="mb-3">
                                    <label class="form-label">{{ 'INVITATION_CODE_KEY'|trans }}</label>
                                    {{ form_widget(registrationForm.parentCode, {
                                        'attr': {
                                            'class': 'form-control' ~ (registrationForm.parentCode.vars.errors|length > 0 ? ' is-invalid' : ''),
                                            'value': last_parent_code is defined ? last_parent_code : ''
                                        }
                                    }) }}
                                    {% if registrationForm.parentCode.vars.errors|length > 0 %}
                                        <div class="invalid-feedback d-block">
                                            {% for error in registrationForm.parentCode.vars.errors %}
                                                {{ error.message|trans }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>

                                <!-- Full Name -->
                                <div class="mb-3">
                                    <label class="form-label">{{ 'FULL_NAME_KEY'|trans }}</label>
                                    {{ form_widget(registrationForm.fullName, {
                                        'attr': {
                                            'class': 'form-control' ~ (registrationForm.fullName.vars.errors|length > 0 ? ' is-invalid' : ''),
                                            'value': last_fullname is defined ? last_fullname : ''
                                        }
                                    }) }}
                                    {% if registrationForm.fullName.vars.errors|length > 0 %}
                                        <div class="invalid-feedback d-block">
                                            {% for error in registrationForm.fullName.vars.errors %}
                                                {{ error.message|trans }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>

                                <!-- Username -->
                                <div class="mb-3">
                                    <label class="form-label">{{ 'USERNAME_KEY'|trans }}</label>
                                    {{ form_widget(registrationForm.username, {
                                        'attr': {
                                            'class': 'form-control' ~ (registrationForm.username.vars.errors|length > 0 ? ' is-invalid' : ''),
                                            'value': last_username is defined ? last_username : ''
                                        }
                                    }) }}
                                    {% if registrationForm.username.vars.errors|length > 0 %}
                                        <div class="invalid-feedback d-block">
                                            {% for error in registrationForm.username.vars.errors %}
                                                {{ error.message|trans }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>

                                <!-- Phone Number -->
                                <div class="mb-3">
                                    <label class="form-label">{{ 'PHONE_NUMBER_KEY'|trans }}</label>
                                    {{ form_widget(registrationForm.phoneNumber, {
                                        'attr': {
                                            'class': 'form-control' ~ (registrationForm.phoneNumber.vars.errors|length > 0 ? ' is-invalid' : ''),
                                            'value': last_phone is defined ? last_phone : ''
                                        }
                                    }) }}
                                    {% if registrationForm.phoneNumber.vars.errors|length > 0 %}
                                        <div class="invalid-feedback d-block">
                                            {% for error in registrationForm.phoneNumber.vars.errors %}
                                                {{ error.message|trans }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>

                                <!-- Password -->
                                <div class="mb-3">
                                    <label class="form-label">{{ 'PASSWORD_KEY'|trans }}</label>
                                    <div class="input-group">
                                        {{ form_widget(registrationForm.plainPassword, {
                                            'attr': {
                                                'class': 'form-control' ~ (registrationForm.plainPassword.vars.errors|length > 0 ? ' is-invalid' : ''),
                                                'placeholder': 'PASSWORD_PLACEHOLDER_KEY'|trans
                                            }
                                        }) }}
                                        <span class="input-group-text p-0">
                                            <button type="button" class="btn btn-outline-secondary h-100 toggle-password">
                                                <i class="bi bi-eye"></i>
                                            </button>
                                        </span>
                                    </div>
                                    {% if registrationForm.plainPassword.vars.errors|length > 0 %}
                                        <div class="invalid-feedback d-block">
                                            {% for error in registrationForm.plainPassword.vars.errors %}
                                                {{ error.message|trans }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                    <small class="text-muted">
                                        {{ 'MIN_4_CHARS_KEY'|trans }}
                                    </small>
                                </div>

                                <!-- Password Confirmation -->
                                <div class="mb-3">
                                    <label class="form-label">{{ 'CONFIRM_PASSWORD_KEY'|trans }}</label>
                                    <div class="input-group">
                                        {{ form_widget(registrationForm.confirmPassword, {
                                            'attr': {
                                                'class': 'form-control' ~ (registrationForm.confirmPassword.vars.errors|length > 0 ? ' is-invalid' : ''),
                                                'placeholder': 'CONFIRM_PASSWORD_PLACEHOLDER_KEY'|trans
                                            }
                                        }) }}
                                        <span class="input-group-text p-0">
                                            <button type="button" class="btn btn-outline-secondary h-100 toggle-password">
                                                <i class="bi bi-eye"></i>
                                            </button>
                                        </span>
                                    </div>
                                    {% if registrationForm.confirmPassword.vars.errors|length > 0 %}
                                        <div class="invalid-feedback d-block">
                                            {% for error in registrationForm.confirmPassword.vars.errors %}
                                                {{ error.message|trans }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>

                                <!-- Terms -->
                                <div class="mb-3">
                                    {{ form_widget(registrationForm.agreeTerms, {
                                        'attr': {
                                            'class': 'form-check-input me-2' ~ (registrationForm.agreeTerms.vars.errors|length > 0 ? ' is-invalid' : '')
                                        }
                                    }) }}
                                    <label class="form-check-label">
                                        {{ 'AGREE_TO_TERMS_KEY'|trans }} <a href="{{ path('app_terms') }}" target="_blank">{{ 'TERMS_KEY'|trans }}</a>
                                    </label>
                                    {% if registrationForm.agreeTerms.vars.errors|length > 0 %}
                                        <div class="invalid-feedback d-block">
                                            {% for error in registrationForm.agreeTerms.vars.errors %}
                                                {{ error.message|trans }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>

                                <div class="align-items-center mt-0">
                                    <button class="btn btn-primary" type="submit" id="submit-button">{{ 'REGISTER_KEY'|trans }}</button>
                                </div>
                            {{ form_end(registrationForm) }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get all password toggle buttons
            const toggleButtons = document.querySelectorAll('.toggle-password');
            
            toggleButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // Find the closest input group and get the password input
                    const inputGroup = this.closest('.input-group');
                    const passwordInput = inputGroup.querySelector('input');
                    const icon = this.querySelector('i');
                    
                    // Toggle password visibility
                    if (passwordInput.type === 'password') {
                        passwordInput.type = 'text';
                        icon.classList.remove('bi-eye');
                        icon.classList.add('bi-eye-slash');
                    } else {
                        passwordInput.type = 'password';
                        icon.classList.remove('bi-eye-slash');
                        icon.classList.add('bi-eye');
                    }
                });
            });
        });
    </script>
{% endblock %}